
<div id="navbar">
    <div id="characterBtn" (click)="changeTab('character')" [ngClass]="{'activeTab': showNav == 'character'}">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
            <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z"/>
        </svg>
    </div>
    <div id="statsBtn" (click)="changeTab('stats')" [ngClass]="{'activeTab': showNav == 'stats'}">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-through-heart" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M2.854 15.854A.5.5 0 0 1 2 15.5V14H.5a.5.5 0 0 1-.354-.854l1.5-1.5A.5.5 0 0 1 2 11.5h1.793l.53-.53c-.771-.802-1.328-1.58-1.704-2.32-.798-1.575-.775-2.996-.213-4.092C3.426 2.565 6.18 1.809 8 3.233c1.25-.98 2.944-.928 4.212-.152L13.292 2 12.147.854A.5.5 0 0 1 12.5 0h3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.854.354L14 2.707l-1.006 1.006c.236.248.44.531.6.845.562 1.096.585 2.517-.213 4.092-.793 1.563-2.395 3.288-5.105 5.08L8 13.912l-.276-.182a22 22 0 0 1-2.685-2.062l-.539.54V14a.5.5 0 0 1-.146.354zm2.893-4.894A20.4 20.4 0 0 0 8 12.71c2.456-1.666 3.827-3.207 4.489-4.512.679-1.34.607-2.42.215-3.185-.817-1.595-3.087-2.054-4.346-.761L8 4.62l-.358-.368c-1.259-1.293-3.53-.834-4.346.761-.392.766-.464 1.845.215 3.185.323.636.815 1.33 1.519 2.065l1.866-1.867a.5.5 0 1 1 .708.708z"/>
        </svg>
    </div>
    <div id="skillBtn" (click)="changeTab('skill')" [ngClass]="{'activeTab': showNav == 'skill'}">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-sliders" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M11.5 2a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M9.05 3a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0V3zM4.5 7a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3M2.05 8a2.5 2.5 0 0 1 4.9 0H16v1H6.95a2.5 2.5 0 0 1-4.9 0H0V8zm9.45 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3m-2.45 1a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0v-1z"/>
        </svg>
    </div>
    <div id="combatBtn" (click)="changeTab('combat')" [ngClass]="{'activeTab': showNav == 'combat'}"> 
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-emoji-angry" viewBox="0 0 16 16">
            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
            <path d="M4.285 12.433a.5.5 0 0 0 .683-.183A3.5 3.5 0 0 1 8 10.5c1.295 0 2.426.703 3.032 1.75a.5.5 0 0 0 .866-.5A4.5 4.5 0 0 0 8 9.5a4.5 4.5 0 0 0-3.898 2.25.5.5 0 0 0 .183.683m6.991-8.38a.5.5 0 1 1 .448.894l-1.009.504c.176.27.285.64.285 1.049 0 .828-.448 1.5-1 1.5s-1-.672-1-1.5c0-.247.04-.48.11-.686a.502.502 0 0 1 .166-.761zm-6.552 0a.5.5 0 0 0-.448.894l1.009.504A1.94 1.94 0 0 0 5 6.5C5 7.328 5.448 8 6 8s1-.672 1-1.5c0-.247-.04-.48-.11-.686a.502.502 0 0 0-.166-.761z"/>
        </svg>
    </div>
    <div id="inventoryBtn" (click)="changeTab('inventory')" [ngClass]="{'activeTab': showNav == 'inventory'}">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-backpack2" viewBox="0 0 16 16">
            <path d="M4.04 7.43a4 4 0 0 1 7.92 0 .5.5 0 1 1-.99.14 3 3 0 0 0-5.94 0 .5.5 0 1 1-.99-.14"/>
            <path fill-rule="evenodd" d="M4 9.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5zm1 .5v3h6v-3h-1v.5a.5.5 0 0 1-1 0V10z"/>
            <path d="M6 2.341V2a2 2 0 1 1 4 0v.341c2.33.824 4 3.047 4 5.659v1.191l1.17.585a1.5 1.5 0 0 1 .83 1.342V13.5a1.5 1.5 0 0 1-1.5 1.5h-1c-.456.607-1.182 1-2 1h-7a2.5 2.5 0 0 1-2-1h-1A1.5 1.5 0 0 1 0 13.5v-2.382a1.5 1.5 0 0 1 .83-1.342L2 9.191V8a6 6 0 0 1 4-5.659M7 2v.083a6 6 0 0 1 2 0V2a1 1 0 0 0-2 0M3 13.5A1.5 1.5 0 0 0 4.5 15h7a1.5 1.5 0 0 0 1.5-1.5V8A5 5 0 0 0 3 8zm-1-3.19-.724.362a.5.5 0 0 0-.276.447V13.5a.5.5 0 0 0 .5.5H2zm12 0V14h.5a.5.5 0 0 0 .5-.5v-2.382a.5.5 0 0 0-.276-.447L14 10.309Z"/>
        </svg>
    </div>
</div>

<div id="wrapperBody" #swipeZone class="swipe-container">
    <div id="datosGenerales" [ngClass]="{ 'hidden': showNav != 'character' }">
        <div class="stair-deco-container mb-3">
            <div class="stair-deco-content">{{character?.data?.name}}</div>
            <div class="stair-deco-outer-left"></div>
            <div class="stair-deco-outer-right"></div>
            <div class="stair-deco-mid-left"></div>
            <div class="stair-deco-mid-right"></div>
            <div class="stair-deco-mid-top"></div>
            <div class="stair-deco-mid-bottom"></div>
            <div class="stair-deco-inner-top"></div>
            <div class="stair-deco-inner-bottom"></div>
        </div>
        <table class="table table-striped table-dark dataBox">
            <tbody>
                <tr>
                    <td>Ocupación:</td>
                    <td>{{character?.data?.occupation}}</td>
                
                </tr>
                <tr>
                    <td>Género:</td>
                    <td>{{character?.data?.sex}}</td>
                
                </tr>
                <tr>
                    <td>Edad:</td>
                    <td>{{character?.data?.age}}</td>
                
                </tr>
                <tr>
                    <td>Residencia:</td>
                    <td>{{character?.data?.residence}}</td>
                
                </tr>
                <tr>
                    <td>Nacimiento:</td>
                    <td>{{character?.data?.birthplace}}</td>
                
                </tr>
            </tbody>
        </table>
    </div>
    <div id="characteristicsWrapper" [ngClass]="{ 'hidden': showNav != 'character' }">
        <div class="stair-deco-container mb-3">
            <div class="stair-deco-content">Características</div>
            <div class="stair-deco-outer-left"></div>
            <div class="stair-deco-outer-right"></div>
            <div class="stair-deco-mid-left"></div>
            <div class="stair-deco-mid-right"></div>
            <div class="stair-deco-mid-top"></div>
            <div class="stair-deco-mid-bottom"></div>
            <div class="stair-deco-inner-top"></div>
            <div class="stair-deco-inner-bottom"></div>
        </div>
        <div id="characteristics">
            <div class="characteristic" *ngFor=" let item of ( character?.characteristics | keyvalue: unsorted )">
                <p>{{item.key}}</p>
                <div class="stat art-deco-div" (click)="showDicesFunc(item.value, item.key, 'characteristic')">
                    <div>
                        <p>{{item.value}}</p> 
                    </div>
                    <div class="statHard">
                        <div><p>{{hardThrow(item.value)}}</p></div>
                        <div><p>{{epicThrow(item.value)}}</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- <div id="photo">
        <img src="\assets\images\2392_1.jpg" alt="">
    </div> -->

    <div id="statusWrapper" [ngClass]="{ 'hidden': showNav != 'stats' }">
        <div class="stair-deco-container mb-3">
            <div class="stair-deco-content">Estadísticas</div>
            <div class="stair-deco-outer-left"></div>
            <div class="stair-deco-outer-right"></div>
            <div class="stair-deco-mid-left"></div>
            <div class="stair-deco-mid-right"></div>
            <div class="stair-deco-mid-top"></div>
            <div class="stair-deco-mid-bottom"></div>
            <div class="stair-deco-inner-top"></div>
            <div class="stair-deco-inner-bottom"></div>
        </div>
        <div id="counters">
            <div *ngFor=" let item of ( character?.stats?.currentStats| keyvalue: unsorted )">
                <div class="art-deco-div pb-4 pt-3">
                    <p>{{item.key|translate}}</p>
                </div>
                <div class="countWrapper" (click)="showCalculatorFunc(item.key, item.value)">
                    <p class="count">{{item.value}}</p>
                </div>
            </div>
        </div>
    </div>
    <div id="conditionWrapper" [ngClass]="{ 'hidden': showNav != 'stats' }">
        <div class="stair-deco-container mb-3">
            <div class="stair-deco-content">Condiciones</div>
            <div class="stair-deco-outer-left"></div>
            <div class="stair-deco-outer-right"></div>
            <div class="stair-deco-mid-left"></div>
            <div class="stair-deco-mid-right"></div>
            <div class="stair-deco-mid-top"></div>
            <div class="stair-deco-mid-bottom"></div>
            <div class="stair-deco-inner-top"></div>
            <div class="stair-deco-inner-bottom"></div>
        </div>
        <div>
            @for (item of character?.conditions; track $index) {
                <div>
                    <p class="condition" (click)="showConFunc(item)">{{item}}</p>
                </div>
            }
            <button class="m-3" (click)="showConFunc()">Añadir Condición</button>
        </div>
    </div>

    <div id="skillsWrapper" [ngClass]="{ 'hidden': showNav != 'skill' }">
        <div class="stair-deco-container mb-3">
            <div class="stair-deco-content">Habilidades del investigador</div>
            <div class="stair-deco-outer-left"></div>
            <div class="stair-deco-outer-right"></div>
            <div class="stair-deco-mid-left"></div>
            <div class="stair-deco-mid-right"></div>
            <div class="stair-deco-mid-top"></div>
            <div class="stair-deco-mid-bottom"></div>
            <div class="stair-deco-inner-top"></div>
            <div class="stair-deco-inner-bottom"></div>
        </div>
        <div id="skills">
            <div class="skill" *ngFor=" let item of ( allSkills | keyvalue: unsorted)">
                <p class="mb-1">{{item.key | skillsPipe}}</p>
                <input type="checkbox" [id]="item.key + 'Checkbox'" [checked]="checkboxStates[item.key + 'Checkbox']" disabled="disabled">
                <div class="stat art-deco-div">
                    <div>
                        <p (click)="showDicesFunc(item.value, item.key, 'skill')">{{item.value}}</p> 
                    </div>
                    <div class="statHard">
                        <div><p>{{hardThrow(item.value)}}</p></div>
                        <div><p>{{epicThrow(item.value)}}</p></div>
                    </div>
                </div>
            </div>
            <div class="w-100 m-3" *ngIf="this.character?.successSkills?.length != 0">
                <button (click)="showLevelFunc()">Desarrollar Investigador</button>
            </div>
        </div>
    </div>

    <div id="gunsWrapper" [ngClass]="{ 'hidden': showNav != 'combat' }">
        <div class="stair-deco-container mb-3">
            <div class="stair-deco-content">Armas</div>
            <div class="stair-deco-outer-left"></div>
            <div class="stair-deco-outer-right"></div>
            <div class="stair-deco-mid-left"></div>
            <div class="stair-deco-mid-right"></div>
            <div class="stair-deco-mid-top"></div>
            <div class="stair-deco-mid-bottom"></div>
            <div class="stair-deco-inner-top"></div>
            <div class="stair-deco-inner-bottom"></div>
        </div>
        <!-- <table class="table">
            <thead>
            <tr>
                <th scope="col">Arma</th>
                <th scope="col">Normal</th>
                <th scope="col">Difícil</th>
                <th scope="col">Extremo</th>
                <th scope="col">Daño</th>
                <th scope="col">Alcance</th>
                <th scope="col">Ataques</th>
                <th scope="col">Munición</th>
                <th scope="col">Avería</th>
            </tr>
            </thead>
            <tbody>
                <tr (click)="showCombatFunc(allSkills['Pelea'], '1D3+BD')">
                    <th scope="row">Desarmado</th>
                    <td>{{allSkills['Pelea']}}</td>
                    <td>{{hardThrow(allSkills['Pelea'])}}</td>
                    <td>{{epicThrow(allSkills['Pelea'])}}</td>
                    <td>1D3+BD</td>
                    <td>-</td>
                    <td>1</td>
                    <td>-</td>
                    <td>-</td>
                </tr>
                <tr *ngFor="let weapon of character?.weapons" (click)="showCombatFunc(allSkills[weapon.skill],weapon.damage)">
                    <th scope="row">{{weapon.name}}</th>
                    <td>{{allSkills[weapon.skill]}}</td>
                    <td>{{hardThrow(allSkills[weapon.skill])}}</td>
                    <td>{{epicThrow(allSkills[weapon.skill])}}</td>
                    <td>{{weapon.damage | spaceReplace}}</td>
                    <td>{{weapon.range | zeroReplace}}</td>
                    <td>{{weapon.usesRound}}</td>
                    <td>{{weapon.magazine | zeroReplace}}</td>
                    <td>{{weapon.malfunction | zeroReplace}}</td>
                </tr>
            </tbody>
        </table> -->
        <div class="accordion" id="accordionExample">
            <div class="accordion-item">
                <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                    Desarmado
                </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <div>
                        <div>
                            <p>Pelea: </p>
                        </div>
                        <div class="combatTable">
                            <div class="art-deco-div" (click)="showCombatFunc(allSkills['Pelea'], '1D3+BD')">
                                <p>Normal</p>
                                <p>Difícil</p>
                                <p>Extremo</p>
                            </div>
                            <div class="art-deco-div noBorder">
                                <p>{{allSkills['Pelea']}}</p>
                                <p>{{hardThrow(allSkills['Pelea'])}}</p>
                                <p>{{epicThrow(allSkills['Pelea'])}}</p>
                            </div>
                        </div>
                    </div>
                    <table class="table table-striped table-dark dataBox">
                        <tbody>
                            <tr>
                                <td>Daño:</td>
                                <td>1D3+BD</td>
                            
                            </tr>
                            <tr>
                                <td>Ataques:</td>
                                <td>1</td>
                            
                            </tr>
                        </tbody>
                    </table>
                </div>
                </div>
            </div>

            <div class="accordion-item" *ngFor="let weapon of character?.weapons">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" [attr.data-bs-target]="'#'+weapon.name+'accordion'" aria-expanded="false" [attr.aria-controls]="weapon.name+'accordion'">
                        {{weapon.name}}
                    </button>
                </h2>
                <div id="{{weapon.name}}accordion" class="accordion-collapse collapse" data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <div>
                            <div>
                                <p>{{weapon.skill}}: </p>
                            </div>
                            <div class="combatTable">
                                <div class="art-deco-div" (click)="showCombatFunc(allSkills[weapon.skill], weapon.damage)">
                                    <p>Normal</p>
                                    <p>Difícil</p>
                                    <p>Extremo</p>
                                </div>
                                <div class="art-deco-div noBorder">
                                    <p>{{allSkills[weapon.skill]}}</p>
                                    <p>{{hardThrow(allSkills[weapon.skill])}}</p>
                                    <p>{{epicThrow(allSkills[weapon.skill])}}</p>
                                </div>
                            </div>
                        </div>
                        <table class="table table-striped table-dark dataBox">
                            <tbody>
                                <tr>
                                    <td>Daño:</td>
                                    <td>{{weapon.damage | spaceReplace}}</td>
                                
                                </tr>
                                <tr *ngIf="weapon.range">
                                    <td>Rango:</td>
                                    <td>{{weapon.range}}</td>
                                
                                </tr>
                                <tr>
                                    <td>Ataques:</td>
                                    <td>{{weapon.usesRound}}</td>
                                
                                </tr>
                                <tr *ngIf="weapon.magazine">
                                    <td>Munición:</td>
                                    <td>{{weapon.magazine}}</td>
                                
                                </tr>
                                <tr *ngIf="weapon.malfunction">
                                    <td>Avería:</td>
                                    <td>{{weapon.malfunction}}</td>
                                
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="fightWrapper" [ngClass]="{ 'hidden': showNav != 'combat' }">
        <div class="stair-deco-container mb-3">
            <div class="stair-deco-content">Combate</div>
            <div class="stair-deco-outer-left"></div>
            <div class="stair-deco-outer-right"></div>
            <div class="stair-deco-mid-left"></div>
            <div class="stair-deco-mid-right"></div>
            <div class="stair-deco-mid-top"></div>
            <div class="stair-deco-mid-bottom"></div>
            <div class="stair-deco-inner-top"></div>
            <div class="stair-deco-inner-bottom"></div>
        </div>
        <table class="table table-striped table-dark dataBox">
            <tbody>
                <tr>
                    <td>Bonif. Daño:</td>
                    <td>{{character?.combat?.damageBonus?.modifyer}}
                        @if (character?.combat?.damageBonus?.dice != null) {
                            D{{character?.combat?.damageBonus?.dice}}
                        }
                    </td>
                
                </tr>
                <tr>
                    <td>Corpulencia:</td>
                    <td>{{character?.combat?.build}}</td>
                
                </tr>
                <tr>
                    <td>Esquivar:</td>
                    <td></td>
                
                </tr>
            </tbody>
        </table>
        <div class="dodgeBox">
            <div class="combatTable" (click)="showDicesFunc(allSkills['Esquivar'], 'Esquivar', 'skill')">
                <div class="art-deco-div">
                    <p>Normal</p>
                    <p>Difícil</p>
                    <p>Extremo</p>
                </div>
                <div class="art-deco-div noBorder">
                    <p>{{allSkills['Esquivar']}}</p>
                    <p>{{hardThrow(allSkills['Esquivar'])}}</p>
                    <p>{{epicThrow(allSkills['Esquivar'])}}</p>
                </div>
            </div>
        </div>
    </div>

    <div id="inventoryWrapper" [ngClass]="{ 'hidden': showNav != 'inventory' }">
        <div class="stair-deco-container mb-3">
            <div class="stair-deco-content">Inventario</div>
            <div class="stair-deco-outer-left"></div>
            <div class="stair-deco-outer-right"></div>
            <div class="stair-deco-mid-left"></div>
            <div class="stair-deco-mid-right"></div>
            <div class="stair-deco-mid-top"></div>
            <div class="stair-deco-mid-bottom"></div>
            <div class="stair-deco-inner-top"></div>
            <div class="stair-deco-inner-bottom"></div>
        </div>
        @for (item of character?.objects | keyvalue; track $index) {
            <div class="itemWrap">
                <div>
                    <p *ngIf=deleteMode (click)="modItem(item.key, item.value)">X</p>
                    <p>{{item.key}}
                        @if (item.value != 1){
                            : {{item.value}}
                        }
                    </p>
                </div>
            </div>
        }
        <div class="buttons">
            <button (click)="enterDeleteMode()">
                @if (deleteMode) {
                    Aceptar
                }@else{
                    Modificar
                }
            </button>
            <button (click)="showInvFunc()">Añadir</button>
        </div>
    </div>
    
    @if (showDices) {
        <div class="popupWrapper">
            <dices class="popup" [successThreshold] = successThreshold [currentLuck] = character?.stats?.currentStats?.luck [typeThrow] = typeThrow (expendedLuck)="expendedStatRecived($event)" (markedSuccess)="markSkill($event)"/>
        </div>
        <div id="popupBackgroud" (click)="showDicesFunc(0,'','')"></div>
    }
    
    @if (showCalculator) {
        <div class="popupWrapper">
            <stadistics-calculator class="popup" [statClicked] = statClicked [statCurrent] = statCurrent (expendedStat)="expendedStatRecived($event)"/>
        </div>
        <div id="popupBackgroud" (click)="showCalculatorFunc('', 0)"></div>
    }
    
    @if (showInventory) {
        <div class="popupWrapper">
            <inventory-editor class="popup" (item)="addItem($event)"/>
        </div>
        <div id="popupBackgroud" (click)="showInvFunc()"></div>
    }
    
    @if (showCombat) {
        <div class="popupWrapper">
            <combat-dices class="popup" [successThreshold]="successThreshold" [damage]="damage" [modyfierBonus]="character?.combat?.damageBonus?.modifyer" [diceBonus]="character?.combat?.damageBonus?.dice || 0"/>
        </div>
        <div id="popupBackgroud" (click)="showCombatFunc(0,'')"></div>
    }

    @if (showCondition) {
        <div class="popupWrapper">
            <condition-editor class="popup"  [conditionName] = "conditionName" (conditionOut)="changeCondition($event)"/>
        </div>
        <div id="popupBackgroud" (click)="showConFunc()"></div>
    }

    @if (showLevelUp) {
        <div class="popupWrapper">
            <level-up class="popup" [successSkills]="successSkills" [skills]="allSkills || {}" (upgradedSkillsOut)="endUpgrade($event)"/>
        </div>
        <div id="popupBackgroud" (click)="showLevelFunc()"></div>
    }
</div>