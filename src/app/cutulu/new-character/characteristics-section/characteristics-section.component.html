@if(!buttonClicked){
    <div id="buttons">
        <button (click)="characteristicsThrow()" >Hacer tiradas</button>
        <button (click)="characteristicsCustom()">Características personalizadas</button>
    </div>
}@else {
    <h1>Tiradas</h1>
    <p>Ha repartir entre Fuerza, Destreza, Constitución, Apariencia y Poder</p>
    <p>{{characteristicsArray['firstThrow'].join(', ')}}</p>
    <p>Ha repartir entre Inteligencia, Tamaño, Educación</p>
    <p>{{characteristicsArray['secondThrow'].join(', ')}}</p>

    <form [formGroup]="newCharacterCharacteristicsForm" (submit)="saveCharacteristicsCharacter()">
        <div formGroupName="characteristicsForm">
            <div class="mb-3">
                <label for="strength" class="form-label" [matMenuTriggerFor]="tooltipMenu" (click)="changeCharMenu('fuerza')">Fuerza <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" style="fill: white; fill: white; position: relative; top: -1px; left: 6px;"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-.001 5.75c.69 0 1.251.56 1.251 1.25s-.561 1.25-1.251 1.25-1.249-.56-1.249-1.25.559-1.25 1.249-1.25zm2.001 12.25h-4v-1c.484-.179 1-.201 1-.735v-4.467c0-.534-.516-.618-1-.797v-1h3v6.265c0 .535.517.558 1 .735v.999z"/></svg></label>
                <div class="box">
                    <div class="box-inner">
                        @if (!custom) {
                            <select class="form-select" aria-label="Default select example" id="strength" formControlName="strength">
                                @for (item of characteristicsArray['firstThrow']; track $index) {
                                    <option value={{item}}>{{item}}</option>
                                }
                            </select>
                         }@else {
                            <input type="number" class="form-control" id="strength" formControlName="strength">
                         }
                    </div>
                </div>
                <div class="text-danger" *ngIf="hasErrors('characteristicsForm', 'required','strength')">
                    Fuerza obligatoria
                </div>
                <div class="text-danger" *ngIf="hasErrors('characteristicsForm', 'moreThan','strength')">
                    No puede ser mayor de 100
                </div>
            </div>
            <div class="mb-3">
                <label for="dexterity" class="form-label" [matMenuTriggerFor]="tooltipMenu" (click)="changeCharMenu('destreza')">Destreza <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" style="fill: white; fill: white; position: relative; top: -1px; left: 6px;"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-.001 5.75c.69 0 1.251.56 1.251 1.25s-.561 1.25-1.251 1.25-1.249-.56-1.249-1.25.559-1.25 1.249-1.25zm2.001 12.25h-4v-1c.484-.179 1-.201 1-.735v-4.467c0-.534-.516-.618-1-.797v-1h3v6.265c0 .535.517.558 1 .735v.999z"/></svg></label>
                <div class="box">
                    <div class="box-inner">
                        @if (!custom) {
                            <select class="form-select" aria-label="Default select example" id="dexterity" formControlName="dexterity">
                                @for (item of characteristicsArray['firstThrow']; track $index) {
                                    <option value={{item}}>{{item}}</option>
                                }
                            </select>
                        }@else {
                            <input type="number" class="form-control" id="dexterity" formControlName="dexterity">
                        }
                    </div>
                </div>
                <div class="text-danger" *ngIf="hasErrors('characteristicsForm', 'required','dexterity')">
                    Destreza obligatoria
                </div>
                <div class="text-danger" *ngIf="hasErrors('characteristicsForm', 'moreThan','dexterity')">
                    No puede ser mayor de 100
                </div>
            </div>
            <div class="mb-3">
                <label for="constitution" class="form-label" [matMenuTriggerFor]="tooltipMenu" (click)="changeCharMenu('constitucion')">Constitución <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" style="fill: white; fill: white; position: relative; top: -1px; left: 6px;"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-.001 5.75c.69 0 1.251.56 1.251 1.25s-.561 1.25-1.251 1.25-1.249-.56-1.249-1.25.559-1.25 1.249-1.25zm2.001 12.25h-4v-1c.484-.179 1-.201 1-.735v-4.467c0-.534-.516-.618-1-.797v-1h3v6.265c0 .535.517.558 1 .735v.999z"/></svg></label>
                <div class="box">
                    <div class="box-inner">
                        @if (!custom) {
                            <select class="form-select" aria-label="Default select example" id="constitution" formControlName="constitution">
                                @for (item of characteristicsArray['firstThrow']; track $index) {
                                    <option value={{item}}>{{item}}</option>
                                }
                            </select>
                        }@else {
                            <input type="number" class="form-control" id="constitution" formControlName="constitution">
                        }
                    </div>
                </div>
                <div class="text-danger" *ngIf="hasErrors('characteristicsForm', 'required','constitution')">
                    Constitución obligatoria
                </div>
                <div class="text-danger" *ngIf="hasErrors('characteristicsForm', 'moreThan','constitution')">
                    No puede ser mayor de 100
                </div>
            </div>
            <div class="mb-3">
                <label for="appearance" class="form-label" [matMenuTriggerFor]="tooltipMenu" (click)="changeCharMenu('apariencia')">Apariencia <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" style="fill: white; fill: white; position: relative; top: -1px; left: 6px;"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-.001 5.75c.69 0 1.251.56 1.251 1.25s-.561 1.25-1.251 1.25-1.249-.56-1.249-1.25.559-1.25 1.249-1.25zm2.001 12.25h-4v-1c.484-.179 1-.201 1-.735v-4.467c0-.534-.516-.618-1-.797v-1h3v6.265c0 .535.517.558 1 .735v.999z"/></svg></label>
                <div class="box">
                    <div class="box-inner">
                        @if (!custom) {
                            <select class="form-select" aria-label="Default select example" id="appearance" formControlName="appearance">
                                @for (item of characteristicsArray['firstThrow']; track $index) {
                                    <option value={{item}}>{{item}}</option>
                                }
                            </select>
                        }@else {
                            <input type="number" class="form-control" id="appearance" formControlName="appearance">
                        }
                    </div>
                </div>
                <div class="text-danger" *ngIf="hasErrors('characteristicsForm', 'required','appearance')">
                    Apariencia obligatoria
                </div>
                <div class="text-danger" *ngIf="hasErrors('characteristicsForm', 'moreThan','appearance')">
                    No puede ser mayor de 100
                </div>
            </div>
            <div class="mb-3">
                <label for="power" class="form-label" [matMenuTriggerFor]="tooltipMenu" (click)="changeCharMenu('poder')">Poder <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" style="fill: white; fill: white; position: relative; top: -1px; left: 6px;"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-.001 5.75c.69 0 1.251.56 1.251 1.25s-.561 1.25-1.251 1.25-1.249-.56-1.249-1.25.559-1.25 1.249-1.25zm2.001 12.25h-4v-1c.484-.179 1-.201 1-.735v-4.467c0-.534-.516-.618-1-.797v-1h3v6.265c0 .535.517.558 1 .735v.999z"/></svg></label>
                <div class="box">
                    <div class="box-inner">
                        @if (!custom) {
                            <select class="form-select" aria-label="Default select example" id="power" formControlName="power">
                                @for (item of characteristicsArray['firstThrow']; track $index) {
                                    <option value={{item}}>{{item}}</option>
                                }
                            </select>
                        }@else {
                            <input type="number" class="form-control" id="power" formControlName="power">
                        }
                    </div>
                </div>
                <div class="text-danger" *ngIf="hasErrors('characteristicsForm', 'required','power')">
                    Poder obligatorio
                </div>
                <div class="text-danger" *ngIf="hasErrors('characteristicsForm', 'moreThan','power')">
                    No puede ser mayor de 100
                </div>
            </div>
        
            <div class="mb-3">
                <label for="intelligence" class="form-label" [matMenuTriggerFor]="tooltipMenu" (click)="changeCharMenu('inteligencia')">Inteligencia <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" style="fill: white; fill: white; position: relative; top: -1px; left: 6px;"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-.001 5.75c.69 0 1.251.56 1.251 1.25s-.561 1.25-1.251 1.25-1.249-.56-1.249-1.25.559-1.25 1.249-1.25zm2.001 12.25h-4v-1c.484-.179 1-.201 1-.735v-4.467c0-.534-.516-.618-1-.797v-1h3v6.265c0 .535.517.558 1 .735v.999z"/></svg></label>
                <div class="box">
                    <div class="box-inner">
                        @if (!custom) {
                            <select class="form-select" aria-label="Default select example" id="intelligence" formControlName="intelligence">
                                @for (item of characteristicsArray['secondThrow']; track $index) {
                                    <option value={{item}}>{{item}}</option>
                                }
                            </select>
                        }@else {
                            <input type="number" class="form-control" id="intelligence" formControlName="intelligence">
                        }
                    </div>
                </div>
                <div class="text-danger" *ngIf="hasErrors('characteristicsForm', 'required','intelligence')">
                    Inteligencia obligatoria
                </div>
                <div class="text-danger" *ngIf="hasErrors('characteristicsForm', 'moreThan','intelligence')">
                    No puede ser mayor de 100
                </div>
            </div>
            <div class="mb-3">
                <label for="size" class="form-label" [matMenuTriggerFor]="tooltipMenu" (click)="changeCharMenu('tamaño')">Tamaño <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" style="fill: white; fill: white; position: relative; top: -1px; left: 6px;"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-.001 5.75c.69 0 1.251.56 1.251 1.25s-.561 1.25-1.251 1.25-1.249-.56-1.249-1.25.559-1.25 1.249-1.25zm2.001 12.25h-4v-1c.484-.179 1-.201 1-.735v-4.467c0-.534-.516-.618-1-.797v-1h3v6.265c0 .535.517.558 1 .735v.999z"/></svg></label>
                <div class="box">
                    <div class="box-inner">
                        @if (!custom) {
                            <select class="form-select" aria-label="Default select example" id="size" formControlName="size">
                                @for (item of characteristicsArray['secondThrow']; track $index) {
                                    <option value={{item}}>{{item}}</option>
                                }
                            </select>
                        }@else {
                            <input type="number" class="form-control" id="size" formControlName="size">
                        }
                    </div>
                </div>
                <div class="text-danger" *ngIf="hasErrors('characteristicsForm', 'required', 'size')">
                    Tamaño obligatorio
                </div>
                <div class="text-danger" *ngIf="hasErrors('characteristicsForm', 'moreThan','size')">
                    No puede ser mayor de 100
                </div>
            </div>
            <div class="mb-3">
                <label for="education" class="form-label" [matMenuTriggerFor]="tooltipMenu" (click)="changeCharMenu('educacion')">Educación <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" style="fill: white; fill: white; position: relative; top: -1px; left: 6px;"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-.001 5.75c.69 0 1.251.56 1.251 1.25s-.561 1.25-1.251 1.25-1.249-.56-1.249-1.25.559-1.25 1.249-1.25zm2.001 12.25h-4v-1c.484-.179 1-.201 1-.735v-4.467c0-.534-.516-.618-1-.797v-1h3v6.265c0 .535.517.558 1 .735v.999z"/></svg></label>
                <div class="box">
                    <div class="box-inner">
                        @if (!custom) {
                            <select class="form-select" aria-label="Default select example" id="education" formControlName="education">
                                @for (item of characteristicsArray['secondThrow']; track $index) {
                                    <option value={{item}}>{{item}}</option>
                                }
                            </select>
                        }@else {
                            <input type="number" class="form-control" id="education" formControlName="education">
                        }
                    </div>
                </div>
                <div class="text-danger" *ngIf="hasErrors('characteristicsForm', 'required', 'education')">
                    Educación obligatorio
                </div>
                <div class="text-danger" *ngIf="hasErrors('characteristicsForm', 'moreThan','education')">
                    No puede ser mayor de 100
                </div>
            </div>
        </div>
        @if (characteristicsForm.valid && !custom) {
            <div formGroupName="modByAgeForm" *ngIf="characteristicsModByAge.length != 0">
                <p>Debido a tu edad tienes que restar un total de {{modCharacteristics}} puntos entre las siguientes características:</p>
                @for (item of characteristicsModByAge; track $index) {
                    <div class="mb-3">
                        <label for="{{ item }}AgeMod" class="form-label">{{ item | translate }}</label>
                        <div class="box">
                            <div class="box-inner">
                                <input type="number" class="form-control" id="{{ item }}AgeMod" formControlName="{{ item }}AgeMod">
                            </div>
                        </div>
                        @if (hasErrors('modByAgeForm', 'moreThan', item +'AgeMod')) {
                            <p class="text-danger">No te puedes quitar más puntos de los que tienes</p>
                        }
                    </div>
                }
            </div>
            @if (modByAgeForm.errors && modByAgeForm.touched){
                <div class="text-danger">Resta todos los puntos</div>
            }
        }
        <div class="text-danger" *ngIf="characteristicsForm.hasError('noRepeat') && characteristicsForm.get('strength')?.touched && characteristicsForm.get('dexterity')?.touched && characteristicsForm.get('constitution')?.touched && characteristicsForm.get('appearance')?.touched && characteristicsForm.get('power')?.touched && characteristicsForm.get('intelligence')?.touched && characteristicsForm.get('size')?.touched && characteristicsForm.get('education')?.touched">
            Reparte las tiradas sin repetirlas.
        </div>

        @if (modByAgeForm.valid && characteristicsForm.valid && characteristicsForm.touched){
            <button type="submit">Siguiente</button>
        }
</form>
}

<mat-menu #tooltipMenu="matMenu" class="customTooltip">
    <div [innerHTML]="tooltipContent"></div>
</mat-menu>